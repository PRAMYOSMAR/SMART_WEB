<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PRAMYOSMAR - Digital App</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --prm: #00695C; --bg: #F8F9FA; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; background: var(--bg); padding-bottom: 100px; overflow-x: hidden; }

        /* HEADER ANTI-NUMPUK */
        .app-header { 
            background: white; padding: 15px 15px 50px; border-radius: 0 0 40px 40px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.05); position: relative; gap: 10px;
        }
        .header-brand { display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0; }
        .logo-ambalan { width: 42px; height: 42px; border-radius: 12px; border: 2px solid var(--prm); flex-shrink: 0; }
        .header-brand h1 { font-size: 18px; margin: 0; font-weight: 800; color: var(--prm); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .header-user-right { text-align: right; flex-shrink: 0; max-width: 40%; }
        .user-name-box { background: #E0F2F1; padding: 4px 10px; border-radius: 8px; }
        .user-name-big { font-size: 12px; font-weight: 800; color: var(--prm); margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* CAROUSEL */
        .carousel-wrapper { margin-top: -30px; padding: 0 15px; }
        .carousel-inner { width: 100%; height: 180px; border-radius: 25px; overflow: hidden; position: relative; background: #222; box-shadow: 0 10px 30px rgba(0,0,0,0.12); }
        .slider-track { display: flex; height: 100%; transition: 0.8s ease-in-out; }
        .slide { flex: 0 0 100%; height: 100%; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }

        /* MENU GRID */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); padding: 25px 15px; gap: 10px; }
        .menu-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .menu-icon { width: 50px; height: 50px; background: var(--prm); border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; margin-bottom: 6px; }
        .menu-item span { font-size: 10px; font-weight: 800; color: var(--prm); }

        /* CARDS */
        .card-item { background: white; border-radius: 20px; padding: 12px; margin-bottom: 12px; display: flex; align-items: center; gap: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.02); }
        .card-img { width: 65px; height: 65px; border-radius: 15px; object-fit: cover; flex-shrink: 0; }
        
        /* NAVIGATION */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; height: 85px; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -8px 25px rgba(0,0,0,0.05); border-radius: 30px 30px 0 0; z-index: 1000; }
        .nav-link { text-align: center; color: #B2BEC3; flex: 1; font-size: 10px; font-weight: 800; cursor: pointer; }
        .nav-link.active { color: var(--prm); }
        .nav-link i { font-size: 22px; display: block; margin-bottom: 4px; }

        .page { display: none; padding-bottom: 110px; animation: fadeInUp 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        #authSection { position: fixed; inset: 0; background: var(--prm); display: flex; align-items: center; justify-content: center; z-index: 10000; transition: 0.5s; }
        .login-card { background: white; width: 85%; max-width: 350px; padding: 40px 30px; border-radius: 35px; text-align: center; }
    </style>
</head>
<body>

    <div id="authSection">
        <div class="login-card">
            <img src="pramyos.jpeg" style="width:80px; border-radius:20px; margin-bottom:20px;">
            <h2 style="color:var(--prm); margin:0;">PRAMYOSMAR</h2>
            <p style="font-size:12px; color:#666; margin: 10px 0 30px;">Silahkan Masuk dengan Nama Anda</p>
            <input type="text" id="userInput" placeholder="Nama Lengkap" style="width:100%; padding:15px; border-radius:15px; border:1px solid #eee; margin-bottom:20px; text-align: center; outline: none;">
            <button onclick="login()" style="width:100%; padding:15px; background:var(--prm); color:white; border:none; border-radius:15px; font-weight:800;">MULAI</button>
        </div>
    </div>

    <div id="pHome" class="page active">
        <div class="app-header">
            <div class="header-brand"><img src="pramyos.jpeg" class="logo-ambalan"><h1>PRAMYOSMAR</h1></div>
            <div class="header-user-right">
                <div class="user-name-box"><p id="topUserName" class="user-name-big">Guest</p></div>
                <span style="font-size:8px; font-weight:800; color:#999;">ANGGOTA</span>
            </div>
        </div>
        <div class="carousel-wrapper">
            <div class="carousel-inner"><div class="slider-track" id="slider"></div></div>
        </div>
        <div class="menu-grid">
            <div class="menu-item" onclick="show('pAnggota')"><div class="menu-icon"><i class="fa-solid fa-users"></i></div><span>Anggota</span></div>
            <div class="menu-item" onclick="show('pBerita')"><div class="menu-icon"><i class="fa-solid fa-camera"></i></div><span>Kegiatan</span></div>
            <div class="menu-item" onclick="show('pMateri')"><div class="menu-icon"><i class="fa-solid fa-book"></i></div><span>Materi</span></div>
            <div class="menu-item" onclick="show('pUjian')"><div class="menu-icon"><i class="fa-solid fa-file-pen"></i></div><span>Ujian</span></div>
        </div>
        <div style="padding: 0 20px;"><h2 style="font-size:16px; color:var(--prm);">Kegiatan Terbaru</h2></div>
        <div id="latestNews" style="padding: 10px 15px;"></div>
    </div>

    <div id="pMateri" class="page">
        <div class="app-header"><h1>Materi Ambalan</h1></div>
        <div id="listMt" style="padding: 20px;"></div>
    </div>

    <div id="pAnggota" class="page"><div class="app-header"><h1>Struktur Ambalan</h1></div><div id="listAg" style="padding:15px;"></div></div>
    <div id="pBerita" class="page"><div class="app-header"><h1>Galeri Kegiatan</h1></div><div id="listBr" style="padding:15px;"></div></div>
    <div id="pUjian" class="page"><div class="app-header"><h1>Ujian CAT</h1></div><div id="listUj" style="padding:20px;"></div></div>
    
    <div id="pPesan" class="page">
        <div class="app-header"><h1>Media Sosial</h1></div>
        <div style="padding: 25px;">
            <a href="https://instagram.com/pramyosmar_bumimoro" target="_blank" style="display:flex; align-items:center; background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888); color:white; padding:20px; border-radius:20px; text-decoration:none; margin-bottom:15px; font-weight:800; gap:15px;">
                <i class="fa-brands fa-instagram fa-2x"></i> INSTAGRAM
            </a>
            <a href="https://tiktok.com/@pramyosmar7" target="_blank" style="display:flex; align-items:center; background:black; color:white; padding:20px; border-radius:20px; text-decoration:none; font-weight:800; gap:15px;">
                <i class="fa-brands fa-tiktok fa-2x"></i> TIKTOK
            </a>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-link active" onclick="show('pHome', this)"><i class="fa-solid fa-house"></i><span>Home</span></div>
        <div class="nav-link" onclick="show('pPesan', this)"><i class="fa-solid fa-hashtag"></i><span>Sosmed</span></div>
        <div class="nav-link" onclick="logout()"><i class="fa-solid fa-power-off"></i><span>Keluar</span></div>
    </nav>

    <script>
        const SUPABASE_URL = 'https://nuzxkanvloxcgxzcixoc.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51enhrYW52bG94Y2d4emNpeG9jIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NzEwMjg0MCwiZXhwIjoyMDgyNjc4ODQwfQ.n9FGB2gxZun3mDw22ulit19jKtI95i9dqwH21175PZE';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let sIdx = 0;

        window.onload = () => {
            const user = localStorage.getItem('pramyos_name');
            if(user) { document.getElementById('authSection').style.display='none'; document.getElementById('topUserName').innerText=user; loadAll(); }
        };

        function login() {
            const n = document.getElementById('userInput').value;
            if(!n) return alert("Masukkan Nama!");
            localStorage.setItem('pramyos_name', n);
            location.reload();
        }

        function logout() { localStorage.clear(); location.reload(); }

        function show(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el) el.classList.add('active');
        }

        async function loadAll() {
            // LOAD KEGIATAN
            const { data: kg } = await _supabase.from('kegiatan').select('*').order('created_at', {ascending:false});
            if(kg) {
                document.getElementById('slider').innerHTML = kg.slice(0,5).map(i => `<div class="slide"><img src="${i.foto_url}"></div>`).join('');
                setInterval(() => { sIdx=(sIdx+1)%kg.slice(0,5).length; document.getElementById('slider').style.transform=`translateX(-${sIdx*100}%)`; }, 5000);
                const kHtml = kg.map(i => `<div class="card-item"><img src="${i.foto_url}" class="card-img"><div><h3 style="font-size:13px; margin:0; color:var(--prm);">${i.judul_kegiatan}</h3><p style="font-size:10px; color:#999; margin-top:4px;">${i.deskripsi}</p></div></div>`).join('');
                document.getElementById('latestNews').innerHTML = kHtml;
                document.getElementById('listBr').innerHTML = kHtml;
            }

            // LOAD ANGGOTA
            const { data: ag } = await _supabase.from('anggota').select('*');
            if(ag) document.getElementById('listAg').innerHTML = ag.map(i => `<div class="card-item"><img src="${i.foto_url}" class="card-img"><div><h3 style="font-size:13px; margin:0; color:var(--prm);">${i.nama}</h3><p style="font-size:10px; color:#999;">${i.jabatan}</p></div></div>`).join('');

            // LOAD MATERI (PDF)
            const { data: mt } = await _supabase.from('materi').select('*');
            if(mt) document.getElementById('listMt').innerHTML = mt.map(i => `
                <div class="card-item">
                    <div class="menu-icon" style="background:#E0F2F1; color:var(--prm);"><i class="fa-solid fa-file-pdf"></i></div>
                    <div style="flex:1;"><h3 style="font-size:14px; margin:0;">${i.judul_materi}</h3><p style="font-size:10px; color:#999;">File Dokumen PDF</p></div>
                    <button onclick="window.open('${i.link_materi}')" style="padding:10px 15px; background:var(--prm); color:white; border:none; border-radius:12px; font-weight:800; font-size:10px;">BACA</button>
                </div>`).join('');

            // LOAD UJIAN
            const { data: uj } = await _supabase.from('ujian').select('*');
            if(uj) document.getElementById('listUj').innerHTML = uj.map(i => `<div class="card-item" style="display:block; text-align:center;"><h3>${i.nama_ujian}</h3><button onclick="window.location.href='${i.link_ujian}'" style="width:100%; padding:15px; background:var(--prm); color:white; border-radius:15px; border:none; font-weight:800;">MULAI UJIAN SEKARANG</button></div>`).join('');
        }
    </script>
</body>
</html>
